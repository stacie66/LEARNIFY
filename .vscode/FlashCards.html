<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard App</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc1e9;
            --light-color: #f5f7fa;
            --dark-color: #333;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --baby-blue: #89CFF0;
            --baby-blue-light: #B5E2FA;
            --baby-blue-dark: #6CB4D9;
            --white: #FFFFFF;
            --light-gray: #F5F7FA;
            --dark-gray: #4A4A4A;
            --sidebar-width: 250px;
            --header-height: 70px;
        }

        body {
            background-color: var(--light-gray);
            display: flex;
            height: 100vh;
        }

        /* Sidebar styles */
        .sidebar {
            width: var(--sidebar-width);
            height: 100%;
            background-color: var(--white);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: all 0.3s;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .sidebar-header h2 {
            color: var(--baby-blue);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            color: var(--dark-gray);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--baby-blue-light);
            border-left-color: var(--baby-blue);
        }

        .menu-item.active {
            background-color: var(--baby-blue-light);
            border-left-color: var(--baby-blue);
            font-weight: 600;
        }

        .menu-item i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            position: absolute;
            bottom: 0;
            width: 100%;
            text-align: center;
        }

        .logout-btn {
            background-color: var(--baby-blue);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            font-weight: 600;
        }

        .logout-btn:hover {
            background-color: var(--baby-blue-dark);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f4f8;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .deck-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .flashcard-container {
            perspective: 1000px;
            min-height: 300px;
            margin: 20px auto;
            max-width: 600px;
        }
        
        .flashcard {
            position: relative;
            width: 100%;
            height: 300px;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            border-radius: 10px;
        }
        
        .flashcard-front {
            background-color: var(--primary-color);
            color: white;
        }
        
        .flashcard-back {
            background-color: var(--secondary-color);
            color: white;
            transform: rotateY(180deg);
        }
        
        .card-text {
            font-size: 24px;
            text-align: center;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: #3a9fcb;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .deck-selector {
            margin-bottom: 20px;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            background-color: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            background-color: #f5f7fa;
            transition: background-color 0.3s ease;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .decks {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .deck-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .deck-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .deck-title {
            font-size: 20px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .deck-stats {
            display: flex;
            justify-content: space-between;
            color: #777;
            font-size: 14px;
            margin-top: 15px;
        }
        
        .progress-bar {
            height: 5px;
            background-color: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
        }
        
        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        @media screen and (max-width: 768px) {
            .decks {
                grid-template-columns: 1fr;
            }
            
            .deck-controls {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Learnify</h2>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="menu-item active">
                <i class="fas fa-home"></i>
                Dashboard
            </a>
            <a href="FlashCards.html" class="menu-item">
                <i class="fas fa-sticky-note"></i>
                Flashcards
            </a>
            <a href="Quizzes.html" class="menu-item">
                <i class="fas fa-question-circle"></i>
                Quizzes
            </a>
            <a href="upload.html" class="menu-item">
                <i class="fas fa-file-pdf"></i>
                PDF Upload
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-gamepad"></i>
                Learning Games
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-chart-line"></i>
                Progress
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-cog"></i>
                Settings
            </a>
        </div>
        <div class="sidebar-footer">
            <button id="logout-btn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Flashcard App</h1>
            <p>Create and study flashcards to boost your learning</p>
            
            <a href="Quizzes.html?deckId=YOUR_DECK_ID" class="quiz-link">Start Quiz</a>
        </header>
        
        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="study">Study</div>
                <div class="tab" data-tab="create">Create</div>
                <div class="tab" data-tab="manage">Manage Decks</div>
            </div>
        </div>
        
        <div id="message-container"></div>
        
        <!-- Study Tab Content -->
        <div class="tab-content active" id="study-tab">
            <div class="deck-controls">
                <div class="deck-selector">
                    <label for="deck-select">Select Deck:</label>
                    <select id="deck-select">
                        <option value="">Loading decks...</option>
                    </select>
                </div>
                <div>
                    <span id="card-progress">Card 0/0</span>
                </div>
            </div>
            
            <div class="flashcard-container">
                <div class="flashcard" id="flashcard">
                    <div class="flashcard-front">
                        <p class="card-text" id="front-text">Select a deck to start studying</p>
                    </div>
                    <div class="flashcard-back">
                        <p class="card-text" id="back-text"></p>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <button id="prev-btn" disabled>Previous</button>
                <button id="flip-btn" disabled>Flip</button>
                <button id="next-btn" disabled>Next</button>
            </div>
        </div>
        
        <!-- Create Tab Content -->
        <div class="tab-content" id="create-tab">
            <div class="form-container">
                <h2>Create New Deck</h2>
                <div class="form-group">
                    <label for="new-deck-name">Deck Name:</label>
                    <input type="text" id="new-deck-name" placeholder="Enter deck name">
                </div>
                <div class="form-group">
                    <label for="new-deck-description">Description:</label>
                    <textarea id="new-deck-description" placeholder="Enter deck description"></textarea>
                </div>
                <button id="create-deck-btn">Create Deck</button>
            </div>
            
            <div class="form-container" style="margin-top: 30px;">
                <h2>Add New Card</h2>
                <div class="form-group">
                    <label for="add-to-deck">Select Deck:</label>
                    <select id="add-to-deck">
                        <option value="">Loading decks...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="card-front">Front:</label>
                    <textarea id="card-front" placeholder="Question or prompt"></textarea>
                </div>
                <div class="form-group">
                    <label for="card-back">Back:</label>
                    <textarea id="card-back" placeholder="Answer or explanation"></textarea>
                </div>
                <button id="add-card-btn">Add Card</button>
            </div>
        </div>
        
        <!-- Manage Decks Tab Content -->
        <div class="tab-content" id="manage-tab">
            <h2>Your Flashcard Decks</h2>
            <div class="decks" id="decks-container">
                <!-- Decks will be populated here -->
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentDeckId = null;
        let currentCards = [];
        let currentCardIndex = 0;
        let decks = [];
        
        // API URLs
        const API_URL = 'http://localhost:3000/api/flashcards';
        
        // DOM Elements
        const deckSelect = document.getElementById('deck-select');
        const addToDeckSelect = document.getElementById('add-to-deck');
        const flashcard = document.getElementById('flashcard');
        const frontText = document.getElementById('front-text');
        const backText = document.getElementById('back-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const flipBtn = document.getElementById('flip-btn');
        const cardProgress = document.getElementById('card-progress');
        const messageContainer = document.getElementById('message-container');
        const decksContainer = document.getElementById('decks-container');
        
        // Tab Functionality
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Refresh deck list if managing decks tab
                if (tabId === 'manage') {
                    loadDecks();
                }
            });
        });
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
        
        function init() {
            // Set up event listeners
            flashcard.addEventListener('click', flipCard);
            flipBtn.addEventListener('click', flipCard);
            prevBtn.addEventListener('click', showPreviousCard);
            nextBtn.addEventListener('click', showNextCard);
            document.getElementById('create-deck-btn').addEventListener('click', createDeck);
            document.getElementById('add-card-btn').addEventListener('click', addCard);
            deckSelect.addEventListener('change', selectDeck);
            
            // Load decks
            loadDecks();
        }
        
        // Utility function to show messages
        function showMessage(text, type) {
            messageContainer.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 3000);
        }
        
        // API functions
        async function fetchDecks() {
            try {
                const response = await fetch(`${API_URL}/decks`);
                if (!response.ok) throw new Error('Failed to fetch decks');
                return await response.json();
            } catch (error) {
                console.error('Error fetching decks:', error);
                showMessage('Failed to load decks. Please try again later.', 'error');
                return [];
            }
        }
        
        async function fetchCards(deckId) {
            try {
                const response = await fetch(`${API_URL}/decks/${deckId}/cards`);
                if (!response.ok) throw new Error('Failed to fetch cards');
                return await response.json();
            } catch (error) {
                console.error('Error fetching cards:', error);
                showMessage('Failed to load cards. Please try again later.', 'error');
                return [];
            }
        }
        
        async function createNewDeck(deck) {
            try {
                const response = await fetch(`${API_URL}/decks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(deck)
                });
                
                if (!response.ok) throw new Error('Failed to create deck');
                return await response.json();
            } catch (error) {
                console.error('Error creating deck:', error);
                showMessage('Failed to create deck. Please try again later.', 'error');
                return null;
            }
        }
        
        async function createNewCard(deckId, card) {
            try {
                const response = await fetch(`${API_URL}/decks/${deckId}/cards`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(card)
                });
                
                if (!response.ok) throw new Error('Failed to create card');
                return await response.json();
            } catch (error) {
                console.error('Error creating card:', error);
                showMessage('Failed to add card. Please try again later.', 'error');
                return null;
            }
        }
        
        async function deleteDeck(deckId) {
            try {
                const response = await fetch(`${API_URL}/decks/${deckId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error('Failed to delete deck');
                return true;
            } catch (error) {
                console.error('Error deleting deck:', error);
                showMessage('Failed to delete deck. Please try again later.', 'error');
                return false;
            }
        }
        
        // UI functions
        async function loadDecks() {
            decks = await fetchDecks();
            
            // Populate deck selects
            populateDeckSelects();
            
            // Display decks in the manage tab
            renderDecks();
        }
        
        function populateDeckSelects() {
            const options = decks.length > 0 
                ? decks.map(deck => `<option value="${deck.id}">${deck.name}</option>`).join('')
                : '<option value="">No decks available</option>';
            
            deckSelect.innerHTML = options;
            addToDeckSelect.innerHTML = options;
            
            // Disable study controls if no decks
            flipBtn.disabled = decks.length === 0;
            prevBtn.disabled = true;
            nextBtn.disabled = decks.length === 0;
            
            // Set default text
            if (decks.length === 0) {
                frontText.textContent = 'Create a deck to start studying';
                cardProgress.textContent = 'No cards available';
            }
        }
        
        function renderDecks() {
            if (decks.length === 0) {
                decksContainer.innerHTML = '<p>No decks available. Create a new deck to get started!</p>';
                return;
            }
            
            decksContainer.innerHTML = decks.map(deck => {
                return `
                    <div class="deck-card" data-id="${deck.id}">
                        <h3 class="deck-title">${deck.name}</h3>
                        <p>${deck.description || 'No description'}</p>
                        <div class="deck-stats">
                            <span>${deck.cardCount || 0} cards</span>
                            <span>Created: ${new Date(deck.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: ${deck.progress || 0}%"></div>
                        </div>
                        <div style="margin-top: 15px; display: flex; justify-content: space-between;">
                            <button class="study-deck-btn" data-id="${deck.id}">Study</button>
                            <button class="delete-deck-btn" data-id="${deck.id}">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add event listeners to deck buttons
            document.querySelectorAll('.study-deck-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const deckId = e.target.getAttribute('data-id');
                    deckSelect.value = deckId;
                    selectDeck();
                    
                    // Switch to study tab
                    tabs[0].click();
                });
            });
            
            document.querySelectorAll('.delete-deck-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const deckId = e.target.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this deck? This action cannot be undone.')) {
                        const success = await deleteDeck(deckId);
                        if (success) {
                            showMessage('Deck deleted successfully', 'success');
                            loadDecks();
                        }
                    }
                });
            });
        }
        
        async function selectDeck() {
            const selectedDeckId = deckSelect.value;
            if (!selectedDeckId) return;
            
            currentDeckId = selectedDeckId;
            currentCards = await fetchCards(currentDeckId);
            currentCardIndex = 0;
            
            if (currentCards.length > 0) {
                displayCard();
                updateCardProgress();
                flipBtn.disabled = false;
                nextBtn.disabled = currentCards.length <= 1;
                prevBtn.disabled = true;
            } else {
                frontText.textContent = 'No cards in this deck. Add some cards first!';
                backText.textContent = '';
                cardProgress.textContent = 'No cards available';
                flipBtn.disabled = true;
                prevBtn.disabled = true;
                nextBtn.disabled = true;
            }
        }
        
        function displayCard() {
            if (currentCards.length === 0) return;
            
            const card = currentCards[currentCardIndex];
            frontText.textContent = card.front;
            backText.textContent = card.back;
            
            // Make sure card is showing front side
            if (flashcard.classList.contains('flipped')) {
                flashcard.classList.remove('flipped');
            }
        }
        
        function updateCardProgress() {
            if (currentCards.length === 0) {
                cardProgress.textContent = 'No cards available';
                return;
            }
            
            cardProgress.textContent = `Card ${currentCardIndex + 1}/${currentCards.length}`;
        }
        
        function flipCard() {
            if (currentCards.length === 0) return;
            flashcard.classList.toggle('flipped');
        }
        
        function showPreviousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                displayCard();
                updateCardProgress();
                nextBtn.disabled = false;
                prevBtn.disabled = currentCardIndex === 0;
            }
        }
        
        function showNextCard() {
            if (currentCardIndex < currentCards.length - 1) {
                currentCardIndex++;
                displayCard();
                updateCardProgress();
                prevBtn.disabled = false;
                nextBtn.disabled = currentCardIndex === currentCards.length - 1;
            }
        }
        
        async function createDeck() {
            const nameInput = document.getElementById('new-deck-name');
            const descriptionInput = document.getElementById('new-deck-description');
            
            const name = nameInput.value.trim();
            const description = descriptionInput.value.trim();
            
            if (!name) {
                showMessage('Please enter a deck name', 'error');
                return;
            }
            
            const newDeck = {
                name,
                description,
                createdAt: new Date().toISOString()
            };
            
            const result = await createNewDeck(newDeck);
            if (result) {
                showMessage('Deck created successfully', 'success');
                nameInput.value = '';
                descriptionInput.value = '';
                loadDecks();
            }
        }
        
        async function addCard() {
            const deckId = addToDeckSelect.value;
            const frontInput = document.getElementById('card-front');
            const backInput = document.getElementById('card-back');
            
            const front = frontInput.value.trim();
            const back = backInput.value.trim();
            
            if (!deckId) {
                showMessage('Please select a deck', 'error');
                return;
            }
            
            if (!front || !back) {
                showMessage('Please fill in both front and back of the card', 'error');
                return;
            }
            
            const newCard = {
                front,
                back,
                createdAt: new Date().toISOString()
            };
            
            const result = await createNewCard(deckId, newCard);
            if (result) {
                showMessage('Card added successfully', 'success');
                frontInput.value = '';
                backInput.value = '';
                
                // Refresh current deck if this card was added to it
                if (deckId === currentDeckId) {
                    currentCards = await fetchCards(currentDeckId);
                    updateCardProgress();
                    nextBtn.disabled = currentCardIndex === currentCards.length - 1;
                }
                
                // Update deck counts
                loadDecks();
            }
        }
    </script>
</body>
</html>